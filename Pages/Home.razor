@page "/"
@using EventEaseApp.Models
@using EventEaseApp.Components
@using EventEaseApp.Services
@inject EventService EventService
@inject Blazored.LocalStorage.ILocalStorageService LocalStorage
@inject HttpClient Http
@inject NavigationManager Navigation

<h3>Events List</h3>
<style>
    .list-group-item {
        transition: transform 0.2s ease;
    }
    .list-group-item:hover {
        transform: scale(1.05);
        z-index: 1;
        box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }
</style>
<ul class="list-group">
    @foreach (var evt in EventService.Events)
    {
    <li class="list-group-item" @onclick="() => NavigateToRegister(evt.Id)" style="cursor:pointer;">
            <img src="@evt.ImageUrl" alt="@evt.Name thumbnail" width="60" height="40" style="object-fit:cover; margin-right:10px; vertical-align:middle;" />
            <strong>@evt.Name (@evt.Date.ToString("MMM dd, yyyy"))</strong><br />
            <span>@evt.Location</span><br />
            <span>@evt.Description</span>
        </li>
    }
</ul>

@code {
    private void NavigateToRegister(int eventId)
    {
        Navigation.NavigateTo($"/register?eventId={eventId}");
    }
    protected override async Task OnInitializedAsync()
    {
        var loaded = await LocalStorage.GetItemAsync<List<Event>>("events");
        if (loaded == null || loaded.Count == 0)
        {
            var response = await Http.GetAsync("data/events.json");
            if (response.IsSuccessStatusCode)
            {
                var json = await response.Content.ReadAsStringAsync();
                var events = System.Text.Json.JsonSerializer.Deserialize<List<Event>>(json);
                if (events != null)
                {
                    await LocalStorage.SetItemAsync("events", events);
                    await EventService.LoadEventsAsync();
                }
            }
        }
        else
        {
            await EventService.LoadEventsAsync();
        }
    }

}
